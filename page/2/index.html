<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://blog.exiahan.com">
  <title>ExiaHan&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I am a 逗比.">
<meta property="og:type" content="website">
<meta property="og:title" content="ExiaHan's Blog">
<meta property="og:url" content="http://blog.exiahan.com/page/2/index.html">
<meta property="og:site_name" content="ExiaHan's Blog">
<meta property="og:description" content="I am a 逗比.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ExiaHan's Blog">
<meta name="twitter:description" content="I am a 逗比.">
  
    <link rel="alternative" href="/atom.xml" title="ExiaHan&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" type="text/css" href="/./main.4a39e8.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/avatar.png" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">ExiaHan</a></h1>
		</hgroup>
		
		<p class="header-subtitle">Record everything, day by day. 记录岁月，记录一切。</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/tags/LifeContinues">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'tagcloud')" href="javascript:void(0)">标签</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/exiahan" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/exiahan" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/exiahan" title="zhihu"><i class="icon-zhihu"></i></a>
		        
					<a class="douban" target="_blank" href="http://www.douban.com/people/ExiaHan/" title="douban"><i class="icon-douban"></i></a>
		        
					<a class="mail" target="_blank" href="http://hanyang.945@gmail.com" title="mail"><i class="icon-mail"></i></a>
		        
					<a class="google" target="_blank" href="https://plus.google.com/u/0/105501044492895514671" title="google"><i class="icon-google"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">ExiaHan</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>Record everything, day by day. 记录岁月，记录一切。<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/exiahan" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/exiahan" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/exiahan" title="zhihu"><i class="icon-zhihu"></i></a>
			        
						<a class="douban" target="_blank" href="http://www.douban.com/people/ExiaHan/" title="douban"><i class="icon-douban"></i></a>
			        
						<a class="mail" target="_blank" href="http://hanyang.945@gmail.com" title="mail"><i class="icon-mail"></i></a>
			        
						<a class="google" target="_blank" href="https://plus.google.com/u/0/105501044492895514671" title="google"><i class="icon-google"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 33.333333333333336%"><a href="/">主页</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/archives">所有文章</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/tags/LifeContinues">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-Study-ELF-File-Format" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/31/Study-ELF-File-Format/">Study ELF File Format</a>
    </h1>
  

        
        <a href="/2015/07/31/Study-ELF-File-Format/" class="archive-article-date">
  	<time datetime="2015-07-31T08:30:21.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##前言</p>
<p>为了对Hook， Relocation， 以及一些程序保护技术有更深的了解，正在学习Linux ELF文件格式，所以找到了ELF_Format的文档，这里把里面的一些内容做一下翻译同时记录下。如有错误还请指出，共同学习一起进步啊鲁～ლ(╹◡╹ლ)</p>
<p>##正文</p>
<p>####简介</p>
<p>ELF是Executable and Linking Format的简称，作为Application Binary Interface(ABI)的一部分，是Unix System Laboratories(USL)推出和制定的，是Unix、Linux以及一些类Unix系统使用的一套可执行文件结构标准，Linux下常见的.o,.so以及可执行文件都是ELF文件格式。</p>
<p>ELF文件格式出现的目的是为不同架构的机器提供一个较为统一的规范，减少重新编码、编译的工作量。</p>
<p>ELF文件在Linux中有三种类型：</p>
<ul>
<li>Relocatable File: 可重定位文件，承载代码(说成指令更准确)和数据，可以同其他的<strong>.o</strong>文件一起经由链接器生成Executable File(可执行文件)或者Share Object file(共享对象文件，或者叫动态链接库)。</li>
<li>Executable File：可执行文件，可以被执行，文件中的包含了要被执行的指令和数据等，以及指明了如何创建一个程序的进程镜像。</li>
<li>Shared Object File：共享对象文件，类似于Windows下的Dynamic Link Library(动态链接库)，共享对象文件可以有如下两种Link环境:<ul>
<li>同其他的Relocatable File或者Shared Object File组成一个新的Object File文件</li>
<li>通过<strong>动态链接</strong>的方式，同其他的Shared Object File以及Executable File组成进程镜像。</li>
</ul>
</li>
</ul>
<p>####File Format(文件结构)</p>
<p>ELF的Object File参与了程序的Link和执行，不同的阶段，其文件中的结构略有不同，下表给出了组织结构：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Link View</th>
<th style="text-align:center">Execution View</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ELF Header</td>
<td style="text-align:center">ELF Header</td>
</tr>
<tr>
<td style="text-align:center">Program header table(optional)</td>
<td style="text-align:center">Program header table</td>
</tr>
<tr>
<td style="text-align:center">Section 1</td>
<td style="text-align:center">Segment 1</td>
</tr>
<tr>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
</tr>
<tr>
<td style="text-align:center">Section n</td>
<td style="text-align:center">Segment n</td>
</tr>
<tr>
<td style="text-align:center">…</td>
<td style="text-align:center">…</td>
</tr>
<tr>
<td style="text-align:center">Section header table</td>
<td style="text-align:center">Section header table(optional)</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>ELF Header 包含整个文件的路线图，描述了整个的文件的组成结构</li>
<li>Section 包含了说有Link需要的数据，如指令(instruction)，数据(data)，符号表(Symbol Table)，重定位信息(Relocation Infomation)</li>
<li>Program header table 告诉系统如何创建程序的进程镜像。<em>用于创建进程镜像的文件必有Program header table，相反，重定位文件可以没有</em></li>
<li>Section header table 包含了描述文件中各个section的信息，每个Section在表中都有一个对应的条目，其中包含了Section Name，Size等信息。<em>linking过程中文件必须提此表，其他情形，如已经被链接一个可执行文件可以不需要。</em></li>
</ul>
<hr>
<p><strong>（需要注意的是，ELF文件的结构并不一定是上面表中所列的顺序，事实上除了ELF Header一定在文件头部外，其他部分的顺序都是可变的）</strong></p>
<hr>
<p>####Data Representation(数据表述)</p>
<hr>
<p>为了达到适应不同平台的目的，Object File已一种平台无关的格式存放一些控制数据，从而达到用一种统一的方式定义和翻译Object File，余下的部分数据使用目标处理器(即平台架构)编码方式进行编码。<br>下面是ELF文件定义用到的32Bit-data-types:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">Size</th>
<th style="text-align:center">Alignment</th>
<th style="text-align:center">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Elf32_Addr</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">Unsigned program address</td>
</tr>
<tr>
<td style="text-align:center">Elf32_Half</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
<td style="text-align:center">Unsigned medium integer</td>
</tr>
<tr>
<td style="text-align:center">Elf32_Off</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">Unsigned file ofset</td>
</tr>
<tr>
<td style="text-align:center">Elf32_Sword</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">Signed large integer</td>
</tr>
<tr>
<td style="text-align:center">Elf32_Word</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">Unsigned large integer</td>
</tr>
<tr>
<td style="text-align:center">unsigned char</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Unsigned small integer</td>
</tr>
</tbody>
</table>
<p>Object File中定义的数据结构都遵从“自然”的大小和对齐方式(Po主理解为平台对应)，如果有需要，可以显示指定对齐方式，以保证如4 Bytes的对象一定是4 Bytes对齐的，即该对象所占存储大小是4 Bytes的倍数。举例来说，一个包含Elf32_Addr的成员的数据结构将被4 Bytes对齐。</p>
<p>为了可移植性(Portability)，ELF没有位字段(bit-field)。</p>
<hr>
<p>####ELF Header(文件头)</p>
<p>有些Object File的控制结构(Control Structures)可以增长，因为ELF Header包含了它们的实际大小。如果Object File的文件格式改变，程序可能会遇到控制结构与期望的大小不相符的情况。在这种情况下程序可能会忽略掉“多余”(因为比期望的大小大，可能会多出一些描述数据)的信息；对于“遗失”(因为比期望的大小小)的信息的处理方法依赖于上下文，并且如果定义extensions的话，将在其中被规定相关处理方式。</p>
<p><strong>ELF Header</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EI_NIDENT 16</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>&#123;</div><div class="line">	unsignedchar  	e_ident[EI_NIDENT];</div><div class="line">	Elf32_Half		e_type;</div><div class="line">	Elf32_Half		e_machine;</div><div class="line">	Elf32_Word		e_version;</div><div class="line">	Elf32_Addr		e_entry;</div><div class="line">	Elf32_Off	 	e_phoff;</div><div class="line">	Elf32_Off	 	e_shoff;</div><div class="line">	Elf32_Word		e_flags;</div><div class="line">	Elf32_Half		e_ehsize;</div><div class="line">	Elf32_Half		e_phentsize;</div><div class="line">	Elf32_Half		e_phnum;</div><div class="line">	Elf32_Half		e_shentsize;</div><div class="line">	Elf32_Half		e_shnum;</div><div class="line">	Elf32_Half		e_shstrndx;</div><div class="line">&#125;Elf32_Ehdr;</div></pre></td></tr></table></figure>
<ul>
<li>e_ident 标记整个文件为Object File并且提供平台无关的数据用来解码和翻译整个文件内容。</li>
<li>e_type 说明具体是哪一种Object File：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> Elf32_Type&#123;</div><div class="line">	ET_NONE = <span class="number">0x0</span>;</div><div class="line">	ET_REL = <span class="number">0x1</span>;</div><div class="line">	ET_EXEC = <span class="number">0x2</span>;</div><div class="line">	ET_DYN = <span class="number">0x3</span>;</div><div class="line">	ET_CORE = <span class="number">0x4</span>;</div><div class="line">	ET_LOPROC = <span class="number">0xff00</span>;</div><div class="line">	ET_HIPROC = <span class="number">0xffff</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Core File的内容没有被制定，ET_CORE作为保留字存在。ET_LOPROC/HIPROC两者作为处理器指定语义的保留字，两者可兼或(ET_LOPROC | ET_HIPROC)，其他的一些没有用到的类型同样作为保留字，将来可能用来关联一些新的必要的文件类型。</p>
<ul>
<li>e_machine 指定平台架构：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> Elf32_Machine&#123;</div><div class="line">	EM_NONE = <span class="number">0x0</span>;</div><div class="line">	EM_M32 = <span class="number">0x1</span>;</div><div class="line">	EM_SPARC = <span class="number">0x2</span>;</div><div class="line">	EM_386 = <span class="number">0x3</span>;</div><div class="line">	EM_68K = <span class="number">0x4</span>;</div><div class="line">	EM_88K = <span class="number">0x5</span>;</div><div class="line">	EM_860 = <span class="number">0x7</span>;</div><div class="line">	EM_MIPS = <span class="number">0x8</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>其他的值作为保留字来关联将来可能出现的新平台架构，处理器定制(Processor-specific)ELF名使用机器平台名来区分它们，举例来说：有一个在平台EM_386上的 e<em>flag(会以EF</em>开头) 为 WIDGET，那么，这个flag的将会写成 EF_386_WINDGET。</p>
<ul>
<li>e_version 指定ELF的文件版本，现在只有两个值：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> Elf32_Version&#123;</div><div class="line">	EV_NONE = <span class="number">0x0</span>;</div><div class="line">	EV_CURRENT = <span class="number">0x1</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>目前一般情况下值是1，但一些特殊情况下也会是一些其他的数值(如有扩展的ELF会用一个大数，或者当需要用不同的值来反应当前的版本时)。</p>
<ul>
<li>e_entry 给出system first transfers control需要的用来启动进程的虚拟地址，如果没有入口，那么值是0</li>
</ul>
<p><strong><em>(bytes)表示字节为单位</em></strong></p>
<ul>
<li>e_phoff 给出program header table的offet(bytes)，如果没有，那么是0</li>
<li>e_shoff 给出section header table的offset(bytes)，如果没有，那么是0</li>
<li>e_ehsize ELF Header的size(bytes)，如果没有，那么是0</li>
<li>e_phentsize Program Header Table中每个条目(entry)的size(bytes)，所有的条目大小相同</li>
<li>e_phnum Program Header Table中条目(entry)的数目，因此phentsize × phnum即为整个表的大小(bytes)；如果没有Program Header Table，那么值为0</li>
<li>e_shentsize Section Header Table中每个条目(entry)的size(bytes)，所有条目大小相同</li>
<li>e_shnum Section Header Table中条目(entry)的数目，因此shentsize × shnum即为整个表的大小(bytes)；如果没有Section Header Table，那么值为0</li>
<li>e_shstrndx 存放一个与Section name string table相关的索引(index)，如果没有section name table，那么值为SHN_UNDEF</li>
</ul>
<p>####ELF Identification(ELF 定义)</p>
<p>如前所说，ELF 提供了不同种类的文件框架来适应不同的处理器、数据编码以及不同类型的机器。为了支持整个Object File家族，ELF文件起始处的一连串字节(<strong>elf32_header.e_ident[]</strong>)指出了如何做到平台无关的解析文件(即不用在意是在哪种处理器上做的探询，同时也和文件剩余内容无关)。</p>
<p>ELF头部(Object File同样)起始的几个字节与e_ident[]的成员一致：</p>
<p><em>e_ident[] Identification Index(e_ident[]数组中标识的索引值)：</em></p>
<table>
<thead>
<tr>
<th style="text-align:center">索引名</th>
<th style="text-align:center">值</th>
<th style="text-align:center">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">EI_MAG0</td>
<td style="text-align:center">0x0</td>
<td style="text-align:center">文件标识</td>
</tr>
<tr>
<td style="text-align:center">EI_MAG1</td>
<td style="text-align:center">0x1</td>
<td style="text-align:center">文件标识</td>
</tr>
<tr>
<td style="text-align:center">EI_MAG2</td>
<td style="text-align:center">0x2</td>
<td style="text-align:center">文件标识</td>
</tr>
<tr>
<td style="text-align:center">EI_MAG3</td>
<td style="text-align:center">0x3</td>
<td style="text-align:center">文件标识</td>
</tr>
<tr>
<td style="text-align:center">EI_CLASS</td>
<td style="text-align:center">0x4</td>
<td style="text-align:center">文件类型</td>
</tr>
<tr>
<td style="text-align:center">EI_DATA</td>
<td style="text-align:center">0x5</td>
<td style="text-align:center">数据编码方式</td>
</tr>
<tr>
<td style="text-align:center">EI_VERSION</td>
<td style="text-align:center">0x6</td>
<td style="text-align:center">文件版本</td>
</tr>
<tr>
<td style="text-align:center">EI_PAD</td>
<td style="text-align:center">0x7</td>
<td style="text-align:center">填充字节起始处</td>
</tr>
<tr>
<td style="text-align:center">EI_NIDENT</td>
<td style="text-align:center">0x10</td>
<td style="text-align:center">e_ident[]的大小</td>
</tr>
</tbody>
</table>
<p>上面列出的是e_ident[index]中每个index对应的值，与索引对应位的值定义如下：</p>
<ul>
<li>EI_MAG0～EI_MAG3 文件魔数，标识文件为ELF文件，值依次为<strong>0x7F、’E’、’L’、’F’</strong></li>
<li><p>EI_CLASS 标识文件类型</p>
<ul>
<li>ELFCLASSNONE &emsp;0x0 &emsp; 无效文件</li>
<li>ELFCLASS32 &emsp;&emsp;&emsp;0x1 &emsp; 32bit文件</li>
<li>ELFCLASS64 &emsp;&emsp;&emsp;0x2 &emsp; 64bit文件</li>
</ul>
</li>
</ul>
<p>ELF文件格式被定义为对于各种不同大小(这里是说如果机器cpu地址线等大小的不同)的机器来说都是便携的，而不用把大型机的文件形式强加于小型机上。ELFCLASS32类型可以支持虚拟地址最大到4GiB(2^32 Bytes),它使用的其他定义和之前已经描述到的相同。</p>
<p>ELFCLASS64是为64位架构保留的，出现在这里仅仅是为了体现未来可能的变化方向，但是64位的定义还没被定义。其他类型将按需被定义，以适应不同的基本类型和大小的Object File。</p>
<ul>
<li><p>EI_DATA 指定编码方式，现在有如下三种：</p>
<ul>
<li>ELFDATANONE &emsp; 0x0 &emsp; 无效数据编码</li>
<li>ELFDATA2LSB &emsp; 0x1 &emsp; 小端(低位在低地址)</li>
<li>ELFDATA2MSB &emsp; 0x2 &emsp; 大端(低位在高地址)</li>
</ul>
</li>
<li><p>EI_VERSION 指定ELF版本号，现在必须是EV_CURRENT(0x1)</p>
</li>
<li>EI_PAD 标志着e_ident[]中未使用字节的起始索引，现阶段作为保留字节全为0x0，以后可能会有其他用途。</li>
<li>EI_NIDENT 表示e_ident[]的结束位置，这也是固定的，因为e_ident[]长度是16，所以为0x16</li>
</ul>
<p>一个文件的编码方式制定了如何解析文件中的基本对象。就像上面说到的，ELFCLASS32类型的文件使用的对象占用的字节数(bytes)有1Byte，2Bytes和4Bytes。在这种顶一下，数据对象的表示方法如下所示：</p>
<ul>
<li>ELFDATA2LSB</li>
</ul>
<p>ELFDATA2LSB编码方式指定了使用补码，并且最低位有效字节(the least significant byte)放在最低的地址上(小端，Intel主机序)</p>
<table>
<thead>
<tr>
<th style="text-align:right">字节编号</th>
<th style="text-align:center">0x0</th>
<th style="text-align:center">0x1</th>
<th style="text-align:center">0x2</th>
<th>0x3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0x01</td>
<td style="text-align:center">0x1</td>
</tr>
<tr>
<td style="text-align:right">0x0102</td>
<td style="text-align:center">0x02</td>
<td style="text-align:center">0x01</td>
</tr>
<tr>
<td style="text-align:right">0x01020304</td>
<td style="text-align:center">0x04</td>
<td style="text-align:center">0x03</td>
<td style="text-align:center">0x02</td>
<td>0x01</td>
</tr>
</tbody>
</table>
<p>+ELFDATA2MSB</p>
<p>ELFDATA2MSB编码方式指定了使用补码，并且最高位有效字节(the least significant byte)放在最低的地址上(大端，网络序)</p>
<table>
<thead>
<tr>
<th style="text-align:right">字节编号</th>
<th style="text-align:center">0x0</th>
<th style="text-align:center">0x1</th>
<th style="text-align:center">0x2</th>
<th>0x3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0x01</td>
<td style="text-align:center">0x1</td>
</tr>
<tr>
<td style="text-align:right">0x0102</td>
<td style="text-align:center">0x01</td>
<td style="text-align:center">0x02</td>
</tr>
<tr>
<td style="text-align:right">0x01020304</td>
<td style="text-align:center">0x01</td>
<td style="text-align:center">0x02</td>
<td style="text-align:center">0x03</td>
<td>0x04</td>
</tr>
</tbody>
</table>
<p>####Machine Infomation(机器信息)</p>
<p><strong>32Bit Intel Archtecture</strong></p>
<p>根据e_ident[]中的标识符定义，Intel IA32架构要求如下的值</p>
<table>
<thead>
<tr>
<th style="text-align:left">Position</th>
<th style="text-align:left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">e_ident[EI_CLASS]</td>
<td style="text-align:left">ELFCLASS32</td>
</tr>
<tr>
<td style="text-align:left">e_ident[EI_DATA]</td>
<td style="text-align:left">ELFDATA2LSB</td>
</tr>
</tbody>
</table>
<p>驻留在ELF Header中用来标识处理器的e_machine必须是<strong>EM_386</strong></p>
<p>e_flags成员存放与文件相关的按位标识的flags，32Bit Intel Archtecture没有定义flags，所以为0。</p>
<p>####Sections(节)</p>
<p>一个Object File使用一个Section Header Table(节区头表)定位文件中所有的Sections(节)。节区头表是一个由Elf32_Shdr结构体组成的数组。一个节区头表索引(section header table index)相当于这个数组的下标。Elf32_Ehdr.e_shoff给出了从文件起始到节区头表的偏移；Elf32_Ehdr.e_shnum指出节区头表中一共有多少个条目；Elf32_Ehdr.shentzise指出每个条目的大小(其实每个大小都一样)。</p>
<p>有一些节区头表索引值是保留的，一个Object File不会有与这些索引对应的节：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:right">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SHN_UNDEF</td>
<td style="text-align:right">0x0</td>
</tr>
<tr>
<td style="text-align:left">SHN_LORESERVE</td>
<td style="text-align:right">0xFF00</td>
</tr>
<tr>
<td style="text-align:left">SHN_LOPROC</td>
<td style="text-align:right">0xFF00</td>
</tr>
<tr>
<td style="text-align:left">SHN_HIPROC</td>
<td style="text-align:right">0xFF1F</td>
</tr>
<tr>
<td style="text-align:left">SHN_ABS</td>
<td style="text-align:right">0xFFF1</td>
</tr>
<tr>
<td style="text-align:left">SHN_COMMON</td>
<td style="text-align:right">0xFFF2</td>
</tr>
<tr>
<td style="text-align:left">SHN_HIRESERVE</td>
<td style="text-align:right">0xFFFF</td>
</tr>
</tbody>
</table>
<ul>
<li>SHN_UNDEF &emsp; 用来标记一个未定义的、丢失的、无关的、或者其他无意义的节引用(Section Reference)。如一个符号(symbol) “defined” 和 索引Section Number SHN_UNDEF相关，那么它是一个未定义的符号</li>
<li>SHN_LORESERVE &emsp; 保留索引的下界</li>
<li>SHN_LOPROC &emsp;</li>
<li>SHN_HIPROC &emsp; 从SHN_LOPROC到SHN_HIPROC是保留给CPU 的特殊的语义。</li>
<li>SHN_ABS &emsp; 对应引用量的绝对取值，这些值不受重定位影响(<em>Po主理解Virtual Address写死</em>)。举例来说，一个与SHN_ABS节有关的符号(symbol)拥有不受重定位影响的值。</li>
<li>SHN_COMMON &emsp; 与此节相关的是一些公共符号(common symbol)，如Fortran的COMMOM或者未分配的C外部变量</li>
<li>SHN_HIRESERVE &emsp; 保留索引的上界。系统保留了从SHN_LOREVERSE到SHN_HIREVERSE的索引值。这些索引值出现在Section Header Table中，即Section Header Table中不会包含与保留索引值对应的条目。</li>
</ul>
<p>Sections包含了一个Object File除ELF Header、Program Header Table、Section Header Table以外所有的信息。不仅如此，Object File的Sections还需要满足一些条件：</p>
<ul>
<li>每个Section只有一个Section Header来描述它。也有可能有只有Section Header但没有Section的情况。</li>
<li>每个Section占据Object File一段连续的字节空间(也可能为空)</li>
<li>Section之间不能覆盖。不存在一个Section中的直接位于另一个Section中的情况。</li>
<li>一个Object File中可能有无效(inactive)空间(原因在于对齐，硬盘上是512B，内存上是4K)，即文件中各个Headers和Sections可能不会使用到文件的每个字节空间。无效数据所表示的内容是未定义的。</li>
</ul>
<p><strong>Section Header(节头)</strong></p>
<p>Section Header 的结构化定义如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">	Elf32_Word	sh_name;</div><div class="line">	Elf32_Word	sh_type;</div><div class="line">	Elf32_Word	sh_flags;</div><div class="line">	Elf32_Addr	sh_addr;</div><div class="line">	Elf32_Off 	sh_offset;</div><div class="line">	Elf32_Word	sh_size;</div><div class="line">	Elf32_Word	sh_link;</div><div class="line">	Elf32_Word	sh_info;</div><div class="line">	Elf32_Word	sh_addralign;</div><div class="line">	Elf32_Word	sh_entsize;</div><div class="line">&#125;Elf32_Shdr;</div></pre></td></tr></table></figure>
<ul>
<li>sh_name 指出其所在Section的名字，其值是一个index，指向Section Header String Table中的对应条目(一个以’\0’结尾的字符串，C风格字符串)</li>
<li>sh_type 归类总结本段内容和语义</li>
<li>sh_flags 按bit标出一些属性杂项</li>
<li>sh_addr 如果所在Section将出现在一个进程镜像中，则本字段指出本Section第一个Byte应占据的Address，否则为0</li>
<li>sh_offset 从文件起始到这个Section第一个Byte的偏移，如果节类型是SHT_NOBITS，那么此种节不占空间，此时sh_offset仅是一种概念性的表示</li>
<li>sh_size 指出所在Section的大小(bytes)，除非节类型是SHT_NOBITS，否则节在文件中占据sh_size描述的字节大小。一个SHT_NOBITS的sh_size可能不是0，但是缺不会在文件中占据字节空间</li>
<li>sh_link 指出节区头表链接，具体解释依赖具体节区类型</li>
<li>sh_info 给出一些额外信息，具体解释依赖具体节区类型</li>
<li>sh_addralign 许多节区都有地址对齐约束(address alignment constraints)，举例来说：如果一个节存放的是双字(double word)，那么系统必须保证整个节区都是按照Double Word方式对齐。因此，<strong>sh_addr对sh_addralign取模结果必为0</strong>。现阶段仅有0，和2的整数幂是允许的数值，如果值为0或1，则表示没有对齐限制</li>
<li>sh_entsize 一些节区存放一张条目大小固定的表(a table of fixed-size entries)，如符号表。对于这种表，sh_entsize给出条目的大小。如果没有此种表，则为0</li>
</ul>
<p><em>sh_type的类型如下</em></p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:right">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SHT_NULL</td>
<td style="text-align:right">0x0</td>
</tr>
<tr>
<td style="text-align:left">SHT_PROGBITS</td>
<td style="text-align:right">0x1</td>
</tr>
<tr>
<td style="text-align:left">SHT_SYMTAB</td>
<td style="text-align:right">0x2</td>
</tr>
<tr>
<td style="text-align:left">SHT_STRTAB</td>
<td style="text-align:right">0x3</td>
</tr>
<tr>
<td style="text-align:left">SHT_RELA</td>
<td style="text-align:right">0x4</td>
</tr>
<tr>
<td style="text-align:left">SHT_HASH</td>
<td style="text-align:right">0x5</td>
</tr>
<tr>
<td style="text-align:left">SHT_DYNAMIC</td>
<td style="text-align:right">0x6</td>
</tr>
<tr>
<td style="text-align:left">SHT_NOTE</td>
<td style="text-align:right">0x7</td>
</tr>
<tr>
<td style="text-align:left">SHT_NOBITS</td>
<td style="text-align:right">0x8</td>
</tr>
<tr>
<td style="text-align:left">SHT_REL</td>
<td style="text-align:right">0x9</td>
</tr>
<tr>
<td style="text-align:left">SHT_SHLIB</td>
<td style="text-align:right">0xA</td>
</tr>
<tr>
<td style="text-align:left">SHT_DYNSYM</td>
<td style="text-align:right">0xB</td>
</tr>
<tr>
<td style="text-align:left">SHT_LOPROC</td>
<td style="text-align:right">0x70000000</td>
</tr>
<tr>
<td style="text-align:left">SHT_HIPROC</td>
<td style="text-align:right">0x7FFFFFFF</td>
</tr>
<tr>
<td style="text-align:left">SHT_LOUSER</td>
<td style="text-align:right">0x80000000</td>
</tr>
<tr>
<td style="text-align:left">SHT_HIUSER</td>
<td style="text-align:right">0xFFFFFFFF</td>
</tr>
</tbody>
</table>
<ul>
<li>SHT_NULL 标记此Section Header为非活动(inactive)头，不与任何Section关联，此Section Header中其他字段值无定义</li>
<li>SHT_PROGBITS 包含由程序定义的信息，其格式和意义都由程序唯一指定</li>
<li>SHT_SYMTAB 存放一张符号表，现阶段一个Object File每种类型的Section仅能有一个，这个限制在未来可能被解除。SHT_SYMTAB提供用于链接(link, ld)的符号，不过也能用于动态链接。</li>
<li>SHT_STRTAB 存放一张String 表，一个Object File可能有多个string table sections</li>
<li>SHT_RELA 存放用于重定位的条目，并且<strong>明确附加数(with explicit addends)</strong>，如用于32bit Object File的Elf32_Rela重定位类型。<strong>同样，一个Object File可能有多个重定位Section</strong></li>
<li>SHT_HASH 存放符号哈希表(symbol hash table)，所有参与动态链接的对象都必须包含一张符号哈习表，现阶段一个Object File只能包含一张symbol hash table，以后限制可能会解除</li>
<li>SHT_DYNAMIC 存放用于动态链接的信息，现阶段一个Object File只能包含一个SHT_DYNAMIC节，以后可能解除此限制</li>
<li>SHT_NOTE 存放以某种方式标记文件的信息</li>
<li>SHT_NOBITS 不占用文件空间，其他类似SHT_PROGBITSS，尽管不占用文件空间，但是其Section Header中的sh_offset成员放有抽象的文件偏移</li>
<li>SHT_REL 存放用于重定位的条目，但没有<strong>明确附加数(without explicit addends)</strong>，如用于32Bit Object File的Elf32_Rel重定位类型，一个Object File可能含有多个SHT_REL节</li>
<li>SHT_SHLIB 保留的，但是没有指明其意义。带有此节的程序可能没有遵守ABI(Application Binary Interface)</li>
<li>SHT_DYNSYM SHT_SYMTAB标识的Section作为一个完整的符号表，可能包含很对动态链接不需要的符号。因此有些Object File可能还会包含一个SHT_DYNSYM节，用来存放一个动态链接符号(dynamic linking symbols)的最小集合，以节省空间</li>
<li>SHT_LOPROC 从SHT_LOPROC到SHT_HIPROC作为保留的处理器定义语义节(Processor-Specifier Semantics)</li>
<li>SHT_HIPROC 从SHT_LOPROC到SHT_HIPROC作为保留的处理器定义语义节(Processor-Specifier Semantics)</li>
<li>SHT_LOUSER 指出为应用程序保留的Index的下界</li>
<li>SHT_HIUSER 指出为应用程序保留的Index的上界，SHT_LOUSER到SHT_HIUSER之间的Section Types可以被程序使用，而且不会和现在或者将来系统定义的节产生冲突</li>
</ul>
<p>其他的一些Section Type值作为保留字，就像之前提到的，索引为SHN_UNDEF(0x0)的Section Header可以存在，即使SHN_UNDEF标记未定义的节区关系(Section Reference)，SHN_UNDEF标记的Section，其在Section Header Table里对应的Elf32_Shdr结构体条目中所有成员的值均为0x0:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:center">Value</th>
<th style="text-align:left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sh_name</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No name</td>
</tr>
<tr>
<td style="text-align:left">sh_type</td>
<td style="text-align:center">SHT_NULL</td>
<td style="text-align:left">Inactive</td>
</tr>
<tr>
<td style="text-align:left">sh_flags</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No flags</td>
</tr>
<tr>
<td style="text-align:left">sh_addr</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No address</td>
</tr>
<tr>
<td style="text-align:left">sh_offset</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No file offset</td>
</tr>
<tr>
<td style="text-align:left">sh_size</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No size</td>
</tr>
<tr>
<td style="text-align:left">sh_link</td>
<td style="text-align:center">SHN_UNDEF</td>
<td style="text-align:left">No link information</td>
</tr>
<tr>
<td style="text-align:left">sh_info</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No auxiliary informatioon</td>
</tr>
<tr>
<td style="text-align:left">sh_addralign</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No alignment</td>
</tr>
<tr>
<td style="text-align:left">sh_entsize</td>
<td style="text-align:center">0x0</td>
<td style="text-align:left">No entries</td>
</tr>
</tbody>
</table>
<p><em>sh_flags类型如下</em></p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:right">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SHF_WRITE</td>
<td style="text-align:right">0x1</td>
</tr>
<tr>
<td style="text-align:left">SHF_ALLOC</td>
<td style="text-align:right">0x2</td>
</tr>
<tr>
<td style="text-align:left">SHF_EXECINSTR</td>
<td style="text-align:right">0x4</td>
</tr>
<tr>
<td style="text-align:left">SHF_MASKPROC</td>
<td style="text-align:right">0xF0000000</td>
</tr>
</tbody>
</table>
<p>这些flags通过对应的bit是否置1控制，为1即打开，0为关闭，所有未定义属性皆为0</p>
<ul>
<li>SHF_WRITE 所在Section运行时可写</li>
<li>SHF_ALLOC 所在节运行时占据进程内存空间(因为有些控制节运行时不占据进程空间，所以这一位对于这些节来说是关闭)</li>
<li>SHF_EXECINSTR 所在节包含可执行的机器指令</li>
<li>SHF_MASKPROC 为处理器特定语义保留</li>
</ul>
<p><em>sh_link和sh_info给出的信息依赖于所在节</em></p>
<table>
<thead>
<tr>
<th style="text-align:left">sh_type</th>
<th style="text-align:left">sh_link</th>
<th style="text-align:left">sh_info</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SHT_DYNAMIC</td>
<td style="text-align:left">The section header index of the string table used by entries in the section.</td>
<td style="text-align:left">0x0</td>
</tr>
<tr>
<td style="text-align:left">SHT_HASH</td>
<td style="text-align:left">The section header index of the string table to which the hash table applies.</td>
<td style="text-align:left">0x0</td>
</tr>
<tr>
<td style="text-align:left">SHT_REL <br>SHT_RELA</td>
<td style="text-align:left">The section header index of the associated symbol table.</td>
<td style="text-align:left">The section header index of the section to which the relocation applies.</td>
</tr>
<tr>
<td style="text-align:left">SHT_SYMTAB <br>SHT_DYNSYM</td>
<td style="text-align:left">The section header index of the associated string table.</td>
<td style="text-align:left">One greater than the symbol table index of the last local symbol (binding STB_LOCAL).(最后一个局部符号的符号表索引值加一)</td>
</tr>
<tr>
<td style="text-align:left">Other</td>
<td style="text-align:left">SHN_UNDEF</td>
<td style="text-align:left">0x0</td>
</tr>
</tbody>
</table>
<p>####特殊节(Special Sections)</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">ELF</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/Linux/" class="article-tag-list-link color1">Linux</a>
        		</li>
      		
		</ul>
	</div>


      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
    <article id="post-Linux-Hook-Notes" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/29/Linux-Hook-Notes/">Linux Hook Notes</a>
    </h1>
  

        
        <a href="/2015/07/29/Linux-Hook-Notes/" class="archive-article-date">
  	<time datetime="2015-07-29T01:59:25.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2015-07-29</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##Foreword<br>For have read a article in WebSite <a href="http://www.codeproject.com/Articles/33340/Code-Injection-into-Running-Linux-Application" target="_blank" rel="external">code project</a>, and learned lots of from it. So make a memo for later consulting.</p>
<p>##Start<br>First we will make some file for the lab.So we need three file, a .h file, two .c file, the code showed below.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file mylib.h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _MYLIB_H_</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _MYLIB_H_</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">myprint</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str)</span></span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file mylib.c</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mylib.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">myprint</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">   <span class="keyword">static</span> <span class="keyword">unsigned</span> counter = <span class="number">0</span>;</div><div class="line">   counter++;</div><div class="line">   <span class="built_in">printf</span>(<span class="string">"%d, pid (%d)"</span>, counter, getpid());</div><div class="line">   <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//mymain.c</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mylib.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE 1</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">while</span>(TRUE) &#123;</div><div class="line">        myprint();</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Going to sleep\n"</span>);</div><div class="line">        sleep(<span class="number">3</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Wake up\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file myinject.c</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mylib.h"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">injection</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    myprint();</div><div class="line">    system(<span class="string">"date"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For in the above, the file mylib.h, mylib.c is used to generate our test app, and the file myinject.c is used to do our injdect, that is we want hook the myprint function, when myprint is invoke, the function injection will be invoked indeed.</p>
<p>create the three file, and compile like below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ gcc -g -Wall  <span class="_">-f</span>PIC -shared mylib.c -o libmylib.so</div><div class="line">$ gcc -g -lmylib -L ./ mymain.c -o app</div><div class="line">$ gcc -Wall myinject.c -c -o myinject.o</div><div class="line">$ <span class="built_in">export</span> LD_LIBRARY_PATH=.:[your path <span class="built_in">where</span> the libmylib.so <span class="keyword">in</span>]</div></pre></td></tr></table></figure>
<p>For Address-Independent, we add the option -fPIC when build mylib.c to libmylib.so</p>
<p>what you should care is the -lmylib is fixed to the libmylib, so remember to change it if you name your file another name.</p>
<p>##Let’s Rock Our App</p>
<p>Now we can do with the elf file what we just generated.</p>
<p>####1.Start our app</p>
<p>Run our app:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./app</div></pre></td></tr></table></figure></p>
<p>Now we will see the PID via the output. Then we will use gdb to attach the app, via the pid:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ./app</div><div class="line">1, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">2, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">3, pid (5832)Going to sleep</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo gdb -p PID[5832]</div></pre></td></tr></table></figure>
<p>After do this, we now attached to the app:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ sudo gdb -p 5832</div><div class="line">GNU gdb (GDB) 7.9.1</div><div class="line">Copyright (C) 2015 Free Software Foundation, Inc.</div><div class="line">License GPLv3+: GNU GPL version 3 or later</div><div class="line">......</div><div class="line">Attaching to process 6618</div><div class="line">Reading symbols from /home/exiahan/Developments/Linux/hijack/app...done.</div><div class="line">Reading symbols from ./libmylib.so...done.</div><div class="line">Reading symbols from /usr/lib32/libc.so.6...(no debugging symbols found)...done.</div><div class="line">Reading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...done.</div><div class="line">0xf7722c10 <span class="keyword">in</span> __kernel_vsyscall ()</div><div class="line">(gdb)</div></pre></td></tr></table></figure>
<p>####2.Operate and Analysis our app/myinject.o<br>First we load our myinject.o into the app’s process space.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(gdb)call open(<span class="string">"myinject.o"</span>, 2)</div><div class="line">(gdb)call mmap(0, Size, 1|2|4, 2, ReturnFrom-open, 0)</div></pre></td></tr></table></figure></p>
<p>In the open ,the value 2 represent the O_RDWR(Read and Write),then we use mmap function, to put the myinject.o in to the app’s process space, the first and second specify the size of myinject.o, if first is NULL(0), the os justify the start address of the file, the <strong>Size</strong> can be get via:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls <span class="_">-l</span> myinject.o</div></pre></td></tr></table></figure>
<p>Then the 1|2|4 represent PROT_READ | PROT_WRITE | PROT_EXEC, so we can for we will write and execute it. The follow 1 represent the <strong>MAP_SHARED</strong> <strong>[But caution, we can use 2, means MAP_PRIVATE, it also works, the MAP_SHARED  will cause the myinject.o in the file also be changed if we write something, yes, actually we will.][好吧，重要的地方说中文，flags最好设置成MAP_PRIIVATE，这样mmap文件到内存后，修改不会影响disk文件，按照英文的文档用SHARED的话，下次要重新生成myinject.o，不然文件被改，怎么做都不会对的，对，我就是蠢货，没好好看mmap的文档，倒腾一天]</strong>. Also the ReturnFom-open is the return value after we call the open(), after do the above two steps, what we will see is like this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(gdb) call open("myinject.o", 2)</div><div class="line">$1 = 3</div><div class="line">(gdb) call mmap(0, 1044, 1|2|4, 2, 3, 0)</div><div class="line">$2 = -143544320</div><div class="line">(gdb)</div></pre></td></tr></table></figure>
<hr>
<p>Then, we will use readelf to analyse our the app and myinject.o</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[exiahan@Veda hijack]$ readelf -r app</div><div class="line"></div><div class="line">重定位节 <span class="string">'.rel.dyn'</span> 位于偏移量 0x3c8 含有 1 个条目：</div><div class="line"> Offset     Info    Type            Sym.Value  Sym. Name</div><div class="line">08049844  00000506 R_386_GLOB_DAT    00000000   __gmon_start__</div><div class="line"></div><div class="line">重定位节 <span class="string">'.rel.plt'</span> 位于偏移量 0x3d0 含有 5 个条目：</div><div class="line"> Offset     Info    Type            Sym.Value  Sym. Name</div><div class="line">08049854  00000207 R_386_JUMP_SLOT   00000000   sleep</div><div class="line">08049858  00000307 R_386_JUMP_SLOT   00000000   myprint</div><div class="line">0804985c  00000407 R_386_JUMP_SLOT   00000000   puts</div><div class="line">08049860  00000507 R_386_JUMP_SLOT   00000000   __gmon_start__</div><div class="line">08049864  00000607 R_386_JUMP_SLOT   00000000   __libc_start_main</div></pre></td></tr></table></figure>
<p>we can see that the offset of the function we <strong>myprint</strong> want to hook is <strong>0x08049858</strong>, it is the address where it location in the file. But when app be loaded into memory, the the address will change. So how the app still can invoke myprint via call <em>0x08049858, it is the plt(Procedure Linker Table) and the GOT(Global Offset Table), when app is going to invoke myprint, it will call the </em>0x08049858(in fact it’s in the GOT), what in the address is a pointer that pointer to some procedure in plt, via the procedure, will found the real address of myprint, then the address will be put in 0x08049858, in the furture, when invoke myprint, simple call *0x08049858 will work.</p>
<p>So, when the app is running, we can change the value in 0x08049858, then we done the hook operation of the function <strong>myprint</strong>.</p>
<p>For do this, we first get the Base Address of myinject.o in app’s process space:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cat /proc/5832/maps | grep myinject</div><div class="line"></div><div class="line">f771b000<span class="_">-f</span>771c000 rwxp 00000000 fe:03 20342761  [path]/myinject.o</div></pre></td></tr></table></figure>
<p>Now we know that the base-addr is 0xf774f000, then use readelf to get other info we need, like the offset of function injection(), and others that need to be relocated.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ readelf <span class="_">-s</span> myinject.o</div><div class="line"></div><div class="line">Symbol table <span class="string">'.symtab'</span> contains 12 entries:</div><div class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</div><div class="line">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND</div><div class="line">     1: 00000000     0 FILE    LOCAL  DEFAULT  ABS myinject.c</div><div class="line">     2: 00000000     0 SECTION LOCAL  DEFAULT    1</div><div class="line">     3: 00000000     0 SECTION LOCAL  DEFAULT    3</div><div class="line">     4: 00000000     0 SECTION LOCAL  DEFAULT    4</div><div class="line">     5: 00000000     0 SECTION LOCAL  DEFAULT    5</div><div class="line">     6: 00000000     0 SECTION LOCAL  DEFAULT    7</div><div class="line">     7: 00000000     0 SECTION LOCAL  DEFAULT    8</div><div class="line">     8: 00000000     0 SECTION LOCAL  DEFAULT    6</div><div class="line">     9: 00000000    30 FUNC    GLOBAL DEFAULT    1 injection</div><div class="line">    10: 00000000     0 NOTYPE  GLOBAL DEFAULT  UND myprint</div><div class="line">    11: 00000000     0 NOTYPE  GLOBAL DEFAULT  UND system</div></pre></td></tr></table></figure>
<p>We see that the offset of function injection() is 0x0(the value).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ readelf -S myinject.o</div><div class="line">共有 13 个节头，从偏移量 0x20c 开始：</div><div class="line"></div><div class="line">节头：</div><div class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</div><div class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</div><div class="line">  [ 1] .text             PROGBITS        00000000 000034 00001e 00  AX  0   0  1</div><div class="line">  [ 2] .rel.text         REL             00000000 0001ec 000018 08   I 11   1  4</div><div class="line">  [ 3] .data             PROGBITS        00000000 000052 000000 00  WA  0   0  1</div><div class="line">  [ 4] .bss              NOBITS          00000000 000052 000000 00  WA  0   0  1</div><div class="line">  [ 5] .rodata           PROGBITS        00000000 000052 000005 00   A  0   0  1</div><div class="line">  [ 6] .comment          PROGBITS        00000000 000057 000012 01  MS  0   0  1</div><div class="line">  [ 7] .note.GNU-stack   PROGBITS        00000000 000069 000000 00      0   0  1</div><div class="line">  [ 8] .eh_frame         PROGBITS        00000000 00006c 000038 00   A  0   0  4</div><div class="line">  [ 9] .rel.eh_frame     REL             00000000 000204 000008 08   I 11   8  4</div><div class="line">  [10] .shstrtab         STRTAB          00000000 0000a4 00005f 00      0   0  1</div><div class="line">  [11] .symtab           SYMTAB          00000000 000104 0000c0 10     12   9  4</div><div class="line">  [12] .strtab           STRTAB          00000000 0001c4 000025 00      0   0  1</div><div class="line">Key to Flags:</div><div class="line">  W (write), A (alloc), X (execute), M (merge), S (strings)</div><div class="line">  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)</div><div class="line">  O (extra OS processing required) o (OS specific), p (processor specific)</div></pre></td></tr></table></figure>
<p>Now,we know that the offset .text about the file base is 0x34, the .rodata is 0x52, which the string “date” in.<br>So, the entry addr of injection() is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0xf771b000 + 0x34 = 0xf771b034</div></pre></td></tr></table></figure>
<p>So we change the value in 0x08049858 to 0xf771b034:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(gdb)<span class="built_in">set</span> *0x08049858 = 0xf771b034</div></pre></td></tr></table></figure>
<p>But, only change the address of myprint() to injection() is not enough, there are some other entries need to be relocated, below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ readelf -r myinject.o</div><div class="line"></div><div class="line">重定位节 <span class="string">'.rel.text'</span> 位于偏移量 0x1ec 含有 3 个条目：</div><div class="line"> Offset     Info    Type            Sym.Value  Sym. Name</div><div class="line">00000007  00000a02 R_386_PC32        00000000   myprint</div><div class="line">0000000f  00000501 R_386_32          00000000   .rodata</div><div class="line">00000014  00000b02 R_386_PC32        00000000   system</div><div class="line"></div><div class="line">重定位节 <span class="string">'.rel.eh_frame'</span> 位于偏移量 0x204 含有 1 个条目：</div><div class="line"> Offset     Info    Type            Sym.Value  Sym. Name</div><div class="line">00000020  00000202 R_386_PC32        00000000   .text</div></pre></td></tr></table></figure>
<p>As we invoke myprint() and system() in injection(), we give a string arguement “date” that stored in .rodata.<br>Because the myinject.o is load in to mem manual, so we have to do the relocation as the linker.<br>From above we see that there two kinds of relocation:</p>
<ul>
<li>R_386_PC32</li>
<li>R_386_32</li>
</ul>
<p>The R_386_PC32 means that the relocation will related to the value of eip(so called the program counter), simply, the offset is the offset that the real address of entries to the following address of the current instruction address,let <strong>S, A, P</strong> represent the real address in runtime, the addend num and the address that will be affect, in intel x86, the A is store in P, the calucator is:</p>
<center><strong><code>S-P+A</code></strong></center>

<p>(尼码，英语实在说不明白了，大概意思就是计算的偏移和实际运行是的eip相关，计算方法大概是实际所在的地址相对于读到这条指令后，紧接着的指令的地址的偏移。计算方法就是<strong>S、A、P</strong>分别表示的事该条目运行时的<strong>实际所在地址</strong>， <strong>附加数（有时候一个段，如.rodata要重定位的不止一个，一个个排的话肯定需要一个附加数，通常是2,4,8,结构体另说）</strong>，<strong>将被影响的地址，即此地址的值要被修改成真正的地址所在(通过readelf 和加载基地址联合重定位节.rel.text里的偏移得到)</strong>).</p>
<p>The R_386_32 is the absolute offset, just calc via base-addr + offset + addend.<br>(直接加载后基地址加上所在段偏移和附加数就OK)。</p>
<p>So, we will relocation the myprint(), “date”, system():</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#relocate myprint()</span></div><div class="line">(gdb) p *(0xf771b000 + 0x34 + 0x7)</div><div class="line"><span class="variable">$3</span> = -4</div><div class="line">(gdb) p myprint</div><div class="line"><span class="variable">$4</span> = &#123;void ()&#125; 0xf771d550 &lt;myprint&gt;</div><div class="line">(gdb) <span class="built_in">set</span> *(0xf771b000 + 0x34 + 0x7) = 0xf771d550 - (0xf771b000 + 0x34 + 0x7) - 4</div><div class="line"></div><div class="line"><span class="comment">#relocate system()</span></div><div class="line">(gdb) p *(0xf771b000 + 0x34 + 0x14)</div><div class="line"><span class="variable">$5</span> = -4</div><div class="line">(gdb) p system</div><div class="line"><span class="variable">$6</span> = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7542e00 &lt;system&gt;</div><div class="line">(gdb) <span class="built_in">set</span> *(0xf771b000 + 0x34 + 0x14) = 0xf7542e00 - (0xf771b000 + 0x34 + 0x14) - 4</div><div class="line"></div><div class="line"><span class="comment">#relocate "date", in .rodata section, the off of .rodata is 0x52, get from above readelf -S myinject.o</span></div><div class="line">(gdb) p *(0xf771b000 + 0x34 + 0xf)</div><div class="line"><span class="variable">$7</span> = 0</div><div class="line">(gdb) <span class="built_in">set</span> *(0xf771b000 + 0x34 + 0xf) = 0xf771b000 + 0x52</div><div class="line">(gdb)</div></pre></td></tr></table></figure>
<p>####3.Final</p>
<p>After do this, we will get the result like below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">1, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">2, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">3, pid (5832)Going to sleep</div><div class="line">2015年 07月 29日 星期三 21:17:17 CST</div><div class="line">4, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">2015年 07月 29日 星期三 21:17:20 CST</div><div class="line">5, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">2015年 07月 29日 星期三 21:17:23 CST</div><div class="line">6, pid (5832)Going to sleep</div><div class="line">Wake up</div><div class="line">2015年 07月 29日 星期三 21:17:26 CST</div><div class="line">7, pid (5832)Going to sleep</div></pre></td></tr></table></figure>
<p>##Summary<br>So we use gdb(ptrace) to attach a running process, and manual pull a .o file into its process space, then we replace the myprint@got.plt to the address of injection(), then we do the relocation for myinject.o as a linker(yeah, cause when the .o file to a executable file, the linker do the relocation, so we have to do it manually). Then we get our goal.</p>
<p>And in this lab, what we should learn is:</p>
<ul>
<li>ELF File Format</li>
<li>ELF Relocation<ul>
<li>R_386_PC32</li>
<li>R_386_32</li>
</ul>
</li>
<li>Usage of GDB [-p PID]</li>
<li>Usage of mmap [MAP_PRIVATE/SHARED] and open</li>
<li>Usage of readelf [-r -s -S]</li>
<li>Usage of objdump [-s -S]</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">Linux</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">Hook</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">GDB</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Ptrace</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/Linux/" class="article-tag-list-link color1">Linux</a>
        		</li>
      		
		</ul>
	</div>


      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>








  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 ExiaHan
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="./",n(0)}([function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,n){var e=/\/|index.html/g;return t.replace(e,"")===n.replace(e,"")}function i(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,e=0,r=t.length;e<r;e++){var i=t[e];o(n,i.getAttribute("href"))&&(0,d.default)(i,"active")}}function u(t){for(var n=t.offsetLeft,e=t.offsetParent;null!==e;)n+=e.offsetLeft,e=e.offsetParent;return n}function f(t){for(var n=t.offsetTop,e=t.offsetParent;null!==e;)n+=e.offsetTop,e=e.offsetParent;return n}function c(t,n,e,r,o){var i=u(t),c=f(t)-n;if(c-e<=o){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,h.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(e||c)+"px",a.style.left=i+"px",a.style.zIndex=r||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");c(t,document.body.scrollTop,-63,2,0),c(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}function l(){x.default.versions.mobile&&window.screen.width<800&&(i(),s())}var p=e(71),d=r(p),v=e(72),y=(r(v),e(84)),h=r(y),b=e(69),x=r(b),m=e(75),g=r(m),w=e(70);l(),(0,w.addLoadEvent)(function(){g.default.init()}),t.exports={}},function(t,n){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},function(t,n){var e={}.hasOwnProperty;t.exports=function(t,n){return e.call(t,n)}},function(t,n,e){var r=e(49),o=e(15);t.exports=function(t){return r(o(t))}},function(t,n,e){t.exports=!e(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,e){var r=e(6),o=e(12);t.exports=e(4)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},function(t,n,e){var r=e(10),o=e(30),i=e(24),u=Object.defineProperty;n.f=e(4)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},function(t,n,e){var r=e(22)("wks"),o=e(13),i=e(1).Symbol,u="function"==typeof i,f=t.exports=function(t){return r[t]||(r[t]=u&&i[t]||(u?i:o)("Symbol."+t))};f.store=r},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,e){var r=e(35),o=e(16);t.exports=Object.keys||function(t){return r(t,o)}},function(t,n,e){var r=e(11);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var e=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+r).toString(36))}},function(t,n){var e=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=e)},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,e){var r=e(6).f,o=e(2),i=e(7)("toStringTag");t.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},function(t,n,e){var r=e(22)("keys"),o=e(13);t.exports=function(t){return r[t]||(r[t]=o(t))}},function(t,n,e){var r=e(1),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,n){var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},function(t,n,e){var r=e(11);t.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,n,e){var r=e(1),o=e(14),i=e(18),u=e(26),f=e(6).f;t.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||f(n,t,{value:u.f(t)})}},function(t,n,e){n.f=e(7)},function(t,n,e){var r=e(1),o=e(14),i=e(46),u=e(5),f="prototype",c=function(t,n,e){var a,s,l,p=t&c.F,d=t&c.G,v=t&c.S,y=t&c.P,h=t&c.B,b=t&c.W,x=d?o:o[n]||(o[n]={}),m=x[f],g=d?r:v?r[n]:(r[n]||{})[f];d&&(e=n);for(a in e)s=!p&&g&&void 0!==g[a],s&&a in x||(l=s?g[a]:e[a],x[a]=d&&"function"!=typeof g[a]?e[a]:h&&s?i(l,r):b&&g[a]==l?function(t){var n=function(n,e,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,e)}return new t(n,e,r)}return t.apply(this,arguments)};return n[f]=t[f],n}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((x.virtual||(x.virtual={}))[a]=l,t&c.R&&m&&!m[a]&&u(m,a,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},function(t,n,e){var r=e(11),o=e(1).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,n,e){t.exports=!e(4)&&!e(8)(function(){return 7!=Object.defineProperty(e(29)("div"),"a",{get:function(){return 7}}).a})},function(t,n,e){"use strict";var r=e(18),o=e(27),i=e(36),u=e(5),f=e(2),c=e(17),a=e(51),s=e(20),l=e(58),p=e(7)("iterator"),d=!([].keys&&"next"in[].keys()),v="@@iterator",y="keys",h="values",b=function(){return this};t.exports=function(t,n,e,x,m,g,w){a(e,n,x);var O,S,_,j=function(t){if(!d&&t in A)return A[t];switch(t){case y:return function(){return new e(this,t)};case h:return function(){return new e(this,t)}}return function(){return new e(this,t)}},P=n+" Iterator",E=m==h,M=!1,A=t.prototype,T=A[p]||A[v]||m&&A[m],L=T||j(m),N=m?E?j("entries"):L:void 0,C="Array"==n?A.entries||T:T;if(C&&(_=l(C.call(new t)),_!==Object.prototype&&(s(_,P,!0),r||f(_,p)||u(_,p,b))),E&&T&&T.name!==h&&(M=!0,L=function(){return T.call(this)}),r&&!w||!d&&!M&&A[p]||u(A,p,L),c[n]=L,c[P]=b,m)if(O={values:E?L:j(h),keys:g?L:j(y),entries:N},w)for(S in O)S in A||i(A,S,O[S]);else o(o.P+o.F*(d||M),n,O);return O}},function(t,n,e){var r=e(10),o=e(55),i=e(16),u=e(21)("IE_PROTO"),f=function(){},c="prototype",a=function(){var t,n=e(29)("iframe"),r=i.length,o="<",u=">";for(n.style.display="none",e(48).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(o+"script"+u+"document.F=Object"+o+"/script"+u),t.close(),a=t.F;r--;)delete a[c][i[r]];return a()};t.exports=Object.create||function(t,n){var e;return null!==t?(f[c]=r(t),e=new f,f[c]=null,e[u]=t):e=a(),void 0===n?e:o(e,n)}},function(t,n,e){var r=e(35),o=e(16).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,e){var r=e(2),o=e(3),i=e(45)(!1),u=e(21)("IE_PROTO");t.exports=function(t,n){var e,f=o(t),c=0,a=[];for(e in f)e!=u&&r(f,e)&&a.push(e);for(;n.length>c;)r(f,e=n[c++])&&(~i(a,e)||a.push(e));return a}},function(t,n,e){t.exports=e(5)},function(t,n,e){var r=e(15);t.exports=function(t){return Object(r(t))}},function(t,n,e){t.exports={default:e(41),__esModule:!0}},function(t,n,e){t.exports={default:e(42),__esModule:!0}},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var o=e(39),i=r(o),u=e(38),f=r(u),c="function"==typeof f.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":typeof t};n.default="function"==typeof f.default&&"symbol"===c(i.default)?function(t){return"undefined"==typeof t?"undefined":c(t)}:function(t){return t&&"function"==typeof f.default&&t.constructor===f.default&&t!==f.default.prototype?"symbol":"undefined"==typeof t?"undefined":c(t)}},function(t,n,e){e(65),e(63),e(66),e(67),t.exports=e(14).Symbol},function(t,n,e){e(64),e(68),t.exports=e(26).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,e){var r=e(3),o=e(61),i=e(60);t.exports=function(t){return function(n,e,u){var f,c=r(n),a=o(c.length),s=i(u,a);if(t&&e!=e){for(;a>s;)if(f=c[s++],f!=f)return!0}else for(;a>s;s++)if((t||s in c)&&c[s]===e)return t||s||0;return!t&&-1}}},function(t,n,e){var r=e(43);t.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},function(t,n,e){var r=e(9),o=e(34),i=e(19);t.exports=function(t){var n=r(t),e=o.f;if(e)for(var u,f=e(t),c=i.f,a=0;f.length>a;)c.call(t,u=f[a++])&&n.push(u);return n}},function(t,n,e){t.exports=e(1).document&&document.documentElement},function(t,n,e){var r=e(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},function(t,n,e){var r=e(28);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,n,e){"use strict";var r=e(32),o=e(12),i=e(20),u={};e(5)(u,e(7)("iterator"),function(){return this}),t.exports=function(t,n,e){t.prototype=r(u,{next:o(1,e)}),i(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,e){var r=e(9),o=e(3);t.exports=function(t,n){for(var e,i=o(t),u=r(i),f=u.length,c=0;f>c;)if(i[e=u[c++]]===n)return e}},function(t,n,e){var r=e(13)("meta"),o=e(11),i=e(2),u=e(6).f,f=0,c=Object.isExtensible||function(){return!0},a=!e(8)(function(){return c(Object.preventExtensions({}))}),s=function(t){u(t,r,{value:{i:"O"+ ++f,w:{}}})},l=function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!c(t))return"F";if(!n)return"E";s(t)}return t[r].i},p=function(t,n){if(!i(t,r)){if(!c(t))return!0;if(!n)return!1;s(t)}return t[r].w},d=function(t){return a&&v.NEED&&c(t)&&!i(t,r)&&s(t),t},v=t.exports={KEY:r,NEED:!1,fastKey:l,getWeak:p,onFreeze:d}},function(t,n,e){var r=e(6),o=e(10),i=e(9);t.exports=e(4)?Object.defineProperties:function(t,n){o(t);for(var e,u=i(n),f=u.length,c=0;f>c;)r.f(t,e=u[c++],n[e]);return t}},function(t,n,e){var r=e(19),o=e(12),i=e(3),u=e(24),f=e(2),c=e(30),a=Object.getOwnPropertyDescriptor;n.f=e(4)?a:function(t,n){if(t=i(t),n=u(n,!0),c)try{return a(t,n)}catch(t){}if(f(t,n))return o(!r.f.call(t,n),t[n])}},function(t,n,e){var r=e(3),o=e(33).f,i={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],f=function(t){try{return o(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==i.call(t)?f(t):o(r(t))}},function(t,n,e){var r=e(2),o=e(37),i=e(21)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,e){var r=e(23),o=e(15);t.exports=function(t){return function(n,e){var i,u,f=String(o(n)),c=r(e),a=f.length;return c<0||c>=a?t?"":void 0:(i=f.charCodeAt(c),i<55296||i>56319||c+1===a||(u=f.charCodeAt(c+1))<56320||u>57343?t?f.charAt(c):i:t?f.slice(c,c+2):(i-55296<<10)+(u-56320)+65536)}}},function(t,n,e){var r=e(23),o=Math.max,i=Math.min;t.exports=function(t,n){return t=r(t),t<0?o(t+n,0):i(t,n)}},function(t,n,e){var r=e(23),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,n,e){"use strict";var r=e(44),o=e(52),i=e(17),u=e(3);t.exports=e(31)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):"keys"==n?o(0,e):"values"==n?o(0,t[e]):o(0,[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(t,n){},function(t,n,e){"use strict";var r=e(59)(!0);e(31)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},function(t,n,e){"use strict";var r=e(1),o=e(2),i=e(4),u=e(27),f=e(36),c=e(54).KEY,a=e(8),s=e(22),l=e(20),p=e(13),d=e(7),v=e(26),y=e(25),h=e(53),b=e(47),x=e(50),m=e(10),g=e(3),w=e(24),O=e(12),S=e(32),_=e(57),j=e(56),P=e(6),E=e(9),M=j.f,A=P.f,T=_.f,L=r.Symbol,N=r.JSON,C=N&&N.stringify,k="prototype",F=d("_hidden"),q=d("toPrimitive"),I={}.propertyIsEnumerable,B=s("symbol-registry"),D=s("symbols"),W=s("op-symbols"),H=Object[k],K="function"==typeof L,R=r.QObject,J=!R||!R[k]||!R[k].findChild,U=i&&a(function(){return 7!=S(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=M(H,n);r&&delete H[n],A(t,n,e),r&&t!==H&&A(H,n,r)}:A,G=function(t){var n=D[t]=S(L[k]);return n._k=t,n},$=K&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},z=function(t,n,e){return t===H&&z(W,n,e),m(t),n=w(n,!0),m(e),o(D,n)?(e.enumerable?(o(t,F)&&t[F][n]&&(t[F][n]=!1),e=S(e,{enumerable:O(0,!1)})):(o(t,F)||A(t,F,O(1,{})),t[F][n]=!0),U(t,n,e)):A(t,n,e)},Y=function(t,n){m(t);for(var e,r=b(n=g(n)),o=0,i=r.length;i>o;)z(t,e=r[o++],n[e]);return t},Q=function(t,n){return void 0===n?S(t):Y(S(t),n)},X=function(t){var n=I.call(this,t=w(t,!0));return!(this===H&&o(D,t)&&!o(W,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,F)&&this[F][t])||n)},V=function(t,n){if(t=g(t),n=w(n,!0),t!==H||!o(D,n)||o(W,n)){var e=M(t,n);return!e||!o(D,n)||o(t,F)&&t[F][n]||(e.enumerable=!0),e}},Z=function(t){for(var n,e=T(g(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==F||n==c||r.push(n);return r},tt=function(t){for(var n,e=t===H,r=T(e?W:g(t)),i=[],u=0;r.length>u;)!o(D,n=r[u++])||e&&!o(H,n)||i.push(D[n]);return i};K||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=p(arguments.length>0?arguments[0]:void 0),n=function(e){this===H&&n.call(W,e),o(this,F)&&o(this[F],t)&&(this[F][t]=!1),U(this,t,O(1,e))};return i&&J&&U(H,t,{configurable:!0,set:n}),G(t)},f(L[k],"toString",function(){return this._k}),j.f=V,P.f=z,e(33).f=_.f=Z,e(19).f=X,e(34).f=tt,i&&!e(18)&&f(H,"propertyIsEnumerable",X,!0),v.f=function(t){return G(d(t))}),u(u.G+u.W+u.F*!K,{Symbol:L});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;nt.length>et;)d(nt[et++]);for(var nt=E(d.store),et=0;nt.length>et;)y(nt[et++]);u(u.S+u.F*!K,"Symbol",{for:function(t){return o(B,t+="")?B[t]:B[t]=L(t)},keyFor:function(t){if($(t))return h(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){J=!0},useSimple:function(){J=!1}}),u(u.S+u.F*!K,"Object",{create:Q,defineProperty:z,defineProperties:Y,getOwnPropertyDescriptor:V,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),N&&u(u.S+u.F*(!K||a(function(){var t=L();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!$(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return n=r[1],"function"==typeof n&&(e=n),!e&&x(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!$(n))return n}),r[1]=n,C.apply(N,r)}}}),L[k][q]||e(5)(L[k],q,L[k].valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(t,n,e){e(25)("asyncIterator")},function(t,n,e){e(25)("observable")},function(t,n,e){e(62);for(var r=e(1),o=e(5),i=e(17),u=e(7)("toStringTag"),f=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var a=f[c],s=r[a],l=s&&s.prototype;l&&!l[u]&&o(l,u,a),i[a]=i.Array}},function(t,n){"use strict";var e={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("MicroMessenger")==-1}}()};t.exports=e},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=e(40),i=r(o),u=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):o[t]||t}function n(t){return l[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,r=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},f=/\u00a0/g,c=/<br\s*\/?>/gi,a=/\r?\n/g,s=/\s/g,l={};for(var p in o)l[o[p]]=p;return o["&apos;"]="'",l["'"]="&#39;",{encode:function(t){return t?(""+t).replace(r,n).replace(a,"<br/>").replace(s,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(c,"\n").replace(e,t).replace(f," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],e=0,r=t.length;r>e;e++)n.push(t.charCodeAt(e).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],e=0,r=t.length;r>e;e+=2)n.push(String.fromCharCode("0x"+t.slice(e,e+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,e=t.length;e>n;n++)t[n]=u.encodeObject(t[n]);else if("object"==("undefined"==typeof t?"undefined":(0,i.default)(t)))for(var r in t)t[r]=u.encodeObject(t[r]);else if("string"==typeof t)return u.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=u},function(t,n){function e(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=e},function(t,n){function e(t,n){if(t.classList)t.classList.remove(n);else{var e=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(e," ")}}t.exports=e},,,function(t,n){"use strict";function e(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){var n=document.querySelectorAll(".article-entry a:not(.article-more-a)");n.forEach(function(t){t.setAttribute("target","_blank")})}var e=document.querySelector("#js-aboutme");e&&0!==e.length&&(e.innerHTML=e.innerText)}t.exports={init:e}},,,,,,,,,function(t,n){function e(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var e=t.nextSibling;return e?t.parentNode.insertBefore(n,e):t.parentNode.appendChild(n)}t.exports=e}])</script><script src="/./main.4a39e8.js"></script><script>!function(){var e=function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)};e("/slider.e97a05.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 25%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 25%" q-on="click: openSlider(e, 'tagcloud')"><a href="javascript:void(0)" q-class="active:tagcloud">标签</a></li>
      
        
      
      <li style="width: 25%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 25%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">AntiDebug</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Signature Verify</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Android</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Reverse</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Dex</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">CTF</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">SimpleXue</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">DumpClass</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">SourceCode</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Linux</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">ELF</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Shell</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">idf.cn</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">MSC2015</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">WriteUp</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Hook</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">GDB</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Ptrace</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">NSCTF2015</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">XDCTF2015</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Android-Studio</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Xposed</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">SubsTrate</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            2、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: true
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://burningcodes.net/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>光哥</a>
            </li>
          
            <li class="search-li">
              <a href="http://blog.icehoney.me/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>雪月秋水</a>
            </li>
          
            <li class="search-li">
              <a href="http://farseerfc.me/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>farseerfc苣菊</a>
            </li>
          
            <li class="search-li">
              <a href="http://blog.phoenixlzx.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>phoenixlzx</a>
            </li>
          
            <li class="search-li">
              <a href="http://blog.felixc.at/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>felixonmars</a>
            </li>
          
            <li class="search-li">
              <a href="http://lilydjwg.is-programmer.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>百合仙子</a>
            </li>
          
            <li class="search-li">
              <a href="http://nazcalines.github.io/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>汀神</a>
            </li>
          
            <li class="search-li">
              <a href="http://www.programlife.net/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>代码疯子</a>
            </li>
          
            <li class="search-li">
              <a href="https://blog.brickgao.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>高苣菊</a>
            </li>
          
            <li class="search-li">
              <a href="http://www.xiaobaiyey.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>大白的小窝</a>
            </li>
          
            <li class="search-li">
              <a href="http://www.qc1iu.org/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>编译川</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">初出茅庐的安全狗，&lt;br&gt;10级小菜鸟&lt;br&gt;满级200..</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>